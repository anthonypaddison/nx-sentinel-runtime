# 2026-02-16

## What changed
- Renamed `family-board` dashboard/card/assets to `nx-displaygrid` and updated references in HA config/docs.
- Reworked `config/packages/common/home_infra.yaml` sensor definitions to valid HA package schema and renamed it operationally to `nx-sentinel-watchtower` naming.
- Added compatibility fallback in frontend persistence WS calls (`nx_displaygrid/*` then legacy `family_board/*`).
- Added/expanded Node tests covering parser, service, discovery, and helper modules.
- Updated `_mergeConfig` in persistence to use explicit key-presence checks so empty arrays are persisted for `people`, `calendars`, `todos`, and `home_controls`.
- Added `tests/persistence-merge.test.mjs` to verify empty-array override behaviour and missing-key fallback behaviour.
- Reworked `fb-setup-view` into a first-run wizard with four explicit steps: People, Calendars, Integrations guidance, and Review/Finish.
- Added onboarding lifecycle flags in shared config (`onboardingComplete`, `schemaVersion: 1`) and card gating logic so setup reappears when onboarding is incomplete or schema mismatches.
- Added integration guidance text and detected entity pickers (`calendar.*`, `todo.*`) without auto-applying suggested defaults until user confirms via Save/Continue.
- Added a new destructive Settings action **Reset dashboard** with two-step confirmation.
- Reset now clears user/device local persistence keys (`nx-displaygrid:config:*`, `nx-displaygrid:prefs:*`, `nx-displaygrid:data:*`) plus IndexedDB entries in stores `config`, `prefs`, `cache`, then writes explicit empty dashboard config (`people: []`, `calendars: []`, `todos: []`, `onboardingComplete: false`, `schemaVersion: 1`) via existing WS/local fallback path.
- Adjusted WS persistence endpoint ordering to prefer `family_board/config/*` first and keep `nx_displaygrid/config/*` as fallback for compatibility.

## Why
- Reduce regression risk for your primary family command center and align naming with NX conventions.
- Prevent deleted source lists from reappearing when stored config contains explicit empty arrays.
- Ensure first-run setup survives refresh and guides users through required person setup before normal dashboard use.
- Provide a reliable “start over” path that safely wipes cached/local state and re-enters onboarding.

## How to verify
1. Run `node --test tests/*.test.mjs`.
2. In Home Assistant, run **Check configuration**.
3. Confirm dashboard loads at `nx-displaygrid` and resource URL `/local/nx-displaygrid/nx-displaygrid.js`.
4. Confirm infra sensors/entities initialize without invalid config errors.
5. In **Manage sources**, remove all calendars and save; refresh Lovelace and confirm calendars remain empty.
6. Open card in a fresh profile/config; verify wizard shows four steps, allows skipping Integrations, and persists progress after each Save/Continue.
7. Finish wizard, refresh browser, and confirm setup no longer shows while `onboardingComplete: true` and `schemaVersion: 1` are present.
8. In Settings, use **Reset dashboard** and confirm card returns to setup wizard after reset.
9. While saving/resetting, confirm no repeated failed `nx_displaygrid/config/*` WS calls appear before successful `family_board/config/*` calls.
